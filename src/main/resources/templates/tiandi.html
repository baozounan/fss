<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>天地图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" type="text/css" th:href="@{/static/easyui/themes/default/easyui.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/static/easyui/themes/icon.css}">
    <script type="text/javascript" src="http://api.tianditu.gov.cn/api?v=4.0&tk=43f240f0c7548fa36e55fb6b2354b695"></script>
    <script type="text/javascript" th:src="@{/static/easyui/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/static/easyui/jquery.easyui.min.js}"></script>
    <script type="text/javascript" cesium="true" th:src="@{/static/cesium1.58/Cesium.js}"></script>
   <!-- <script type="text/javascript" cesium="true" th:src="@{/static/cesium1.94.3/Cesium.js}"></script>-->
    <script type="text/javascript" cesium="true" src="http://api.tianditu.gov.cn/cdn/plugins/cesium/cesiumTdt.js" ></script>
    <script type="text/javascript" cesium="true" src="https://api.tianditu.gov.cn/cdn/plugins/cesium/Cesium_ext_min.js"></script>
    <script type="text/javascript" cesium="true" src="https://api.tianditu.gov.cn/cdn/plugins/cesium/long.min.js"></script>
    <script type="text/javascript" cesium="true" src="https://api.tianditu.gov.cn/cdn/plugins/cesium/bytebuffer.min.js"></script>
    <script type="text/javascript" cesium="true" src="https://api.tianditu.gov.cn/cdn/plugins/cesium/protobuf.min.js"></script>
    <link rel="stylesheet" cesium="true" href="https://api.tianditu.gov.cn/cdn/demo/sanwei/static/cesium/Widgets/widgets.css">
    <style>
        html, body{
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #cesiumContainer {
            width: 100%;
            height: 100%;
        }

        #cesiumContainer .cesium-viewer-bottom{
            display: none;
        }
    </style>
</head>
<body >

<div class="easyui-layout" style="width:40%;height:100%;float: left;">
    <div data-options="region:'west',split:true" title="导航页" style="width:15%;">
        <a href="javascript:openTab('机场数据','airportManage','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">机场数据</a>
        <a href="javascript:openTab('导航台数据','navigationStation','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">导航台数据</a>
        <a href="javascript:openTab('限制区数据','restrictedArea','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">限制区数据</a>
        <a href="javascript:openTab('fss选址','siteSelection','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">fss选址</a>
        <a href="javascript:openTab('fss服务覆盖','serviceCoverage','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">fss服务覆盖</a>
        <a href="javascript:openTab('选址成本','siteCost','icon-writeblog')" class="easyui-linkbutton"  data-options="plain:true" style="width: 100%;">选址成本</a>


    </div>
    <div  data-options="region:'center',title:'主页',iconCls:'icon-ok'">
        <div class="easyui-tabs" fit="true" border="false" id="tabs">
            <div title="首页" data-options="iconCls:'icon-home'">
                <div align="center" style="padding-top: 150px">
                    <font size="10" color="red">欢迎使用</font>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="cesiumContainer" style="float: right;width:60%;height: 100%;"></div>



<script>
    var token = '43f240f0c7548fa36e55fb6b2354b695';
    // 服务域名
    var tdtUrl = 'https://t{s}.tianditu.gov.cn/';
    // 服务负载子域
    var subdomains=['0','1','2','3','4','5','6','7'];

    // cesium 初始化
    var viewer = new Cesium.Map('cesiumContainer', {
        shouldAnimate: true, //是否允许动画
        selectionIndicator: true,//创建SelectionIndicator小部件。
        baseLayerPicker: false,//不会创建BaseLayerPicker小部件
        fullscreenButton: true,//创建FullscreenButton小部件
        geocoder: true,//创建Geocoder小部件
        homeButton: false,//不会创建HomeButton小部件。
        infoBox: true,//创建InfoBox小部件
        sceneModePicker: false,//不会创建SceneModePicker小部件
        timeline: false,//不会创建时间轴窗口小部件。
        navigationHelpButton: false,//不会创建导航帮助按钮
        navigationInstructionsInitiallyVisible: false,//如果导航说明最初应该是可见的，则为true；如果直到用户明确单击该按钮，则不显示该说明，否则为false
        showRenderLoopErrors: false,//
        shadows: false,//确定阴影是否由太阳投射。
    });

    // 抗锯齿
    viewer.scene.fxaa = true;
    viewer.scene.postProcessStages.fxaa.enabled=false;
    // 水雾特效
    viewer.scene.globe.showGroundAtmosphere = true;
    // 设置最大俯仰角，[-90,0]区间内，默认为-30，单位弧度
    viewer.scene.screenSpaceCameraController.constrainedPitch = Cesium.Math.toRadians(0);
    viewer.scene.screenSpaceCameraController.autoResetHeadingPitch = false;
    viewer.scene.screenSpaceCameraController.inertiaZoom = 0.5;
    viewer.scene.screenSpaceCameraController.minimumZoomDistance = 50;
    viewer.scene.screenSpaceCameraController.maximumZoomDistance = 20000000;
    viewer.scene.screenSpaceCameraController.zoomEventTypes = [
        Cesium.CameraEventType.RIGHT_DRAG,
        Cesium.CameraEventType.WHEEL,
        Cesium.CameraEventType.PINCH,
    ];
    viewer.scene.screenSpaceCameraController.tiltEventTypes = [
        Cesium.CameraEventType.MIDDLE_DRAG,
        Cesium.CameraEventType.PINCH,
        {
            eventType: Cesium.CameraEventType.LEFT_DRAG,
            modifier: Cesium.KeyboardEventModifier.CTRL,
        },
        {
            eventType: Cesium.CameraEventType.RIGHT_DRAG,
            modifier: Cesium.KeyboardEventModifier.CTRL,
        },
    ];
    // 取消默认的双击事件
    viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);

    // 叠加影像服务
    var imgMap = new Cesium.UrlTemplateImageryProvider({
        url: tdtUrl + 'DataServer?T=img_w&x={x}&y={y}&l={z}&tk=' + token,
        subdomains: subdomains,
        tilingScheme : new Cesium.WebMercatorTilingScheme(),
        maximumLevel : 18
    });
    viewer.imageryLayers.addImageryProvider(imgMap);

    // 叠加国界服务
    var iboMap = new Cesium.UrlTemplateImageryProvider({
        url: tdtUrl + 'DataServer?T=ibo_w&x={x}&y={y}&l={z}&tk=' + token,
        subdomains: subdomains,
        tilingScheme : new Cesium.WebMercatorTilingScheme(),
        maximumLevel : 10
    });
    viewer.imageryLayers.addImageryProvider(iboMap);

    // 叠加地形服务
    var terrainUrls = new Array();

    for (var i = 0; i < subdomains.length; i++){
        var url = tdtUrl.replace('{s}', subdomains[i]) + 'mapservice/swdx?T=elv_c&tk=' + token;
        terrainUrls.push(url);
    }

    var provider = new Cesium.GeoTerrainProvider({
        urls: terrainUrls
    });

    viewer.terrainProvider = provider;

    // 将三维球定位到中国
    viewer.camera.flyTo({
        // destination: Cesium.Cartesian3.fromDegrees(103.84, 31.15, 17850000),
        destination: Cesium.Cartesian3.fromDegrees(103, 30, 1249500),
        orientation: {
            heading :  Cesium.Math.toRadians(348.4202942851978),
            pitch : Cesium.Math.toRadians(-89.74026687972041),
            roll : Cesium.Math.toRadians(0)
        },
        complete:function callback() {
            // 定位完成之后的回调函数


        }
    });

    // 叠加三维地名服务
    var wtfs = new Cesium.GeoWTFS({
        viewer,
        //三维地名服务，使用wtfs服务
        subdomains:subdomains,
        metadata:{
            boundBox: {
                minX: -180,
                minY: -90,
                maxX: 180,
                maxY: 90
            },
            minLevel: 1,
            maxLevel: 20
        },
        depthTestOptimization: true,
        dTOElevation: 15000,
        dTOPitch: Cesium.Math.toRadians(-70),
        aotuCollide: true, //是否开启避让
        collisionPadding: [5, 10, 8, 5], //开启避让时，标注碰撞增加内边距，上、右、下、左
        serverFirstStyle: true, //服务端样式优先
        labelGraphics: {
            font:"28px sans-serif",
            fontSize: 28,
            fillColor:Cesium.Color.WHITE,
            scale: 0.5,
            outlineColor:Cesium.Color.BLACK,
            outlineWidth: 2,
            style:Cesium.LabelStyle.FILL_AND_OUTLINE,
            showBackground:false,
            backgroundColor:Cesium.Color.RED,
            backgroundPadding:new Cesium.Cartesian2(10, 10),
            horizontalOrigin:Cesium.HorizontalOrigin.LEFT,
            verticalOrigin:Cesium.VerticalOrigin.TOP,
            eyeOffset:Cesium.Cartesian3.ZERO,
            pixelOffset: new Cesium.Cartesian2(5, 5),
            disableDepthTestDistance:undefined
        },
        billboardGraphics: {
            horizontalOrigin:Cesium.HorizontalOrigin.CENTER,
            verticalOrigin:Cesium.VerticalOrigin.CENTER,
            eyeOffset:Cesium.Cartesian3.ZERO,
            pixelOffset:Cesium.Cartesian2.ZERO,
            alignedAxis:Cesium.Cartesian3.ZERO,
            color:Cesium.Color.WHITE,
            rotation:0,
            scale:1,
            width:18,
            height:18,
            disableDepthTestDistance:undefined
        }
    });

    //三维地名服务，使用wtfs服务
    wtfs.getTileUrl = function(){
        return tdtUrl + 'mapservice/GetTiles?lxys={z},{x},{y}&tk='+ token;
    }

    // 三维图标服务
    wtfs.getIcoUrl = function(){
        return tdtUrl + 'mapservice/GetIcon?id={id}&tk='+ token;
    }

    wtfs.initTDT([{"x":6,"y":1,"level":2,"boundBox":{"minX":90,"minY":0,"maxX":135,"maxY":45}},{"x":7,"y":1,"level":2,"boundBox":{"minX":135,"minY":0,"maxX":180,"maxY":45}},{"x":6,"y":0,"level":2,"boundBox":{"minX":90,"minY":45,"maxX":135,"maxY":90}},{"x":7,"y":0,"level":2,"boundBox":{"minX":135,"minY":45,"maxX":180,"maxY":90}},{"x":5,"y":1,"level":2,"boundBox":{"minX":45,"minY":0,"maxX":90,"maxY":45}},{"x":4,"y":1,"level":2,"boundBox":{"minX":0,"minY":0,"maxX":45,"maxY":45}},{"x":5,"y":0,"level":2,"boundBox":{"minX":45,"minY":45,"maxX":90,"maxY":90}},{"x":4,"y":0,"level":2,"boundBox":{"minX":0,"minY":45,"maxX":45,"maxY":90}},{"x":6,"y":2,"level":2,"boundBox":{"minX":90,"minY":-45,"maxX":135,"maxY":0}},{"x":6,"y":3,"level":2,"boundBox":{"minX":90,"minY":-90,"maxX":135,"maxY":-45}},{"x":7,"y":2,"level":2,"boundBox":{"minX":135,"minY":-45,"maxX":180,"maxY":0}},{"x":5,"y":2,"level":2,"boundBox":{"minX":45,"minY":-45,"maxX":90,"maxY":0}},{"x":4,"y":2,"level":2,"boundBox":{"minX":0,"minY":-45,"maxX":45,"maxY":0}},{"x":3,"y":1,"level":2,"boundBox":{"minX":-45,"minY":0,"maxX":0,"maxY":45}},{"x":3,"y":0,"level":2,"boundBox":{"minX":-45,"minY":45,"maxX":0,"maxY":90}},{"x":2,"y":0,"level":2,"boundBox":{"minX":-90,"minY":45,"maxX":-45,"maxY":90}},{"x":0,"y":1,"level":2,"boundBox":{"minX":-180,"minY":0,"maxX":-135,"maxY":45}},{"x":1,"y":0,"level":2,"boundBox":{"minX":-135,"minY":45,"maxX":-90,"maxY":90}},{"x":0,"y":0,"level":2,"boundBox":{"minX":-180,"minY":45,"maxX":-135,"maxY":90}}]);


    var redPolygon = viewer.entities.add({
        name: "Red polygon on surface",
        polygon: {
            hierarchy: Cesium.Cartesian3.fromDegreesArray([-115.0,37.0,-115.0,32.0,-107.0,33.0,-102.0,31.0,-102.0,35.0, ]),
            material: Cesium.Color.RED.withAlpha(0.5),
        },
    });
    var polyPositions = redPolygon.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions;
    var polyCenter = Cesium.BoundingSphere.fromPoints(polyPositions).center;//中心点
    polyCenter = Cesium.Ellipsoid.WGS84.scaleToGeodeticSurface(polyCenter);
    redPolygon.position = polyCenter;

    redPolygon.label={
        // position:
        text:'Red polygon on surface',
        color : Cesium.Color.fromCssColorString('#fff'),
        font:'normal 32px MicroSoft YaHei',
        showBackground : true,
        scale : 0.5,
        horizontalOrigin : Cesium.HorizontalOrigin.LEFT_CLICK,
        verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
        disableDepthTestDistance : 10000.0
    };

function loadAirportDataInhtml() {

}

function loadRecRestrictAreaData() {

    $.ajax({
        url:'/circularRestrictArea/all',
        type:'get',
        datatype:"json",
        async:"false",
        success:function(result){
            for (var item in result){
                var polycircular = viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(result[item].centerLong, result[item].centerLat),
                    name :result[item].name,
                    ellipse: {
                        semiMinorAxis: result[item].radius,
                        semiMajorAxis: result[item].radius,
                        height: 200,
                        material : Cesium.Color.YELLOW.withAlpha(0.5),
                        outline: true, // height must be set for outline to display
                        heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,
                    },



                });


            }
        }});

    $.ajax({
        url:'/recRestrictArea/all',
        type:'get',
        datatype:"json",
        async:"false",
        success:function(result){
            for (var item in result){
                var pointsarray = [   result[item].long1,result[item].lat1,
                    result[item].long2,result[item].lat2,
                    result[item].long3,result[item].lat3,
                    result[item].long4,result[item].lat4,
                    result[item].long5,result[item].lat5,
                ]
                var filtered = pointsarray.filter(function (el) {
                    return el != null;
                });
                var poly = viewer.entities.add({
                    name :result[item].name,

                    polygon : {
                        hierarchy : Cesium.Cartesian3.fromDegreesArray(filtered),
                        height : 300,
                        material : Cesium.Color.YELLOW.withAlpha(0.5),
                        outline : true,
                        outlineColor : Cesium.Color.BLACK,
                        //heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,
                        heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,
                    },
                    // label:{
                    //     text:"testmsg",
                    //     color:Cesium.Color.WHITE,
                    //     font: '10pt monospace',
                    //     style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    //     outlineWidth : 2,
                    //     verticalOrigin : Cesium.VerticalOrigin.TOP,
                    //     pixelOffset : new Cesium.Cartesian2(0, -9),
                    // },
                });
                poly.label={
                    text:"testmsg",
                    color : Cesium.Color.fromCssColorString('#fff'),
                    font:'normal 32px MicroSoft YaHei',
                    showBackground : false,
                    scale : 0.5,
                   horizontalOrigin : Cesium.HorizontalOrigin.LEFT_CLICK,
                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
                    disableDepthTestDistance : 10000.0
                };

            }
        }});


}




    function loadAirportData() {
        $.ajax({
            url:'/airport/all',
            type:'get',
            datatype:"json",
            async:"false",
            success:function(result){

                var str = "";
                var tbody = document.getElementById("airportManage").contentWindow.document.getElementById('airportsbody');
                //var tbody = document.getElementById("airportManage").document.getElementById('airportsbody');
                for (var item in result){
                    str += "<tr>" +
                        "<td>" + result[item].name + "</td>" +
                        "<td>" + result[item].code + "</td>" +
                        "<td>" + result[item].lon + "</td>" +
                        "<td>" + result[item].lat + "</td>" +
                        "<td>" + result[item].msl + "</td>" +
                        "<td>" + result[item].type + "</td>" +
                        "<td>" + result[item].amount + "</td>" +
                        "</tr>";
                    var entity = new Cesium.Entity({
                        id:"airport"+result[item].airportsId,
                        name:result[item].name,
                        show:true,
                        position:Cesium.Cartesian3.fromDegrees(result[item].lon,result[item].lat),
                        point:new Cesium.PointGraphics({
                            show:false,
                            pixelSize :  5,
                            heightReference :  Cesium.HeightReference.NONE,
                            color : new Cesium.Color ( 255 , 255 , 0 , 1 ),
                            outlineColor : new Cesium.Color ( 0 , 0 , 0 , 0 ),
                            outlineWidth : 1,
                            scaleByDistance : new Cesium.NearFarScalar ( 0 , 1 , 5e10 , 1 ),
                            translucencyByDistance : new Cesium.NearFarScalar ( 0 , 1 , 5e10 , 1 ),
                            distanceDisplayCondition :  new Cesium.DistanceDisplayCondition(0, 4.8e10),

                        }),
                        label:{
                            text:result[item].name,
                            font: '10pt monospace',
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            outlineWidth : 1,
                            verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
                            pixelOffset : new Cesium.Cartesian2(0, -9),
                        },
                        billboard:{
                            image:"../static/image/junyong.png",
                            width:16,
                            height:16,
                        },
                    });
                    viewer.entities.add(entity);
                }
                tbody.innerHTML = str;
            }});
    }

    function removeAirportData(){
        viewer.entities.removeAll();
    }

function removeRecRestrictAreaData() {
    viewer.entities.removeAll();
}
    //加载已有的导航台数据
    function loadnavStationData() {
        $.ajax({
            url:'/navStation/all',
            type:'get',
            datatype:"json",
            async:"false",
            success:function(result){
                var str = "";
                var tbody = document.getElementById("navigationStation").contentWindow.document.getElementById('navStationbody');
                //var tbody = document.getElementById("airportManage").document.getElementById('airportsbody');
                for (var item in result){
                    str += "<tr>" +
                        "<td>" + result[item].stationName+ "</td>" +
                        "<td>" + result[item].navlon + "</td>" +
                        "<td>" + result[item].navlat + "</td>" +
                        "<td>" + result[item].code + "</td>" +
                        "<td>" + result[item].ch + "</td>" +
                        "<td>" + result[item].freq + "</td>" +
                        "<td>" + result[item].navtype + "</td>" +
                        "</tr>";
                    var entity = new Cesium.Entity({
                        id:"navStation"+result[item].stationId,
                        name:result[item].stationName,
                        show:true,
                        position:Cesium.Cartesian3.fromDegrees(result[item].navlon,result[item].navlat),
                        point:new Cesium.PointGraphics({
                            show:false,
                            pixelSize :  5,
                            heightReference :  Cesium.HeightReference.NONE,
                            color : new Cesium.Color ( 255 , 255 , 0 , 1 ),
                            outlineColor : new Cesium.Color ( 0 , 0 , 0 , 0 ),
                            outlineWidth : 1,
                            scaleByDistance : new Cesium.NearFarScalar ( 0 , 1 , 5e10 , 1 ),
                            translucencyByDistance : new Cesium.NearFarScalar ( 0 , 1 , 5e10 , 1 ),
                            distanceDisplayCondition :  new Cesium.DistanceDisplayCondition(0, 4.8e10),

                        }),
                        label:{
                            text:result[item].stationName+"\n"+result[item].freq+" "+result[item].code+"\n"+result[item].ch,
                            font: '10pt monospace',
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            outlineWidth : 1,
                            verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
                            pixelOffset : new Cesium.Cartesian2(0, -9),
                        },
                        billboard:{
                            image:"../static/image/small_airport.png",
                            width:16,
                            height:16,
                        },
                    });
                    viewer.entities.add(entity);
                }
                tbody.innerHTML = str;
            }});
    }

function loadServiceStationData() {
    $.ajax({
        url:'/serviceStation/all',
        type:'get',
        datatype:"json",
        async:"false",
        success:function(result){
            for (var item in result){
                var serviceStation = viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(result[item].lon, result[item].lat),
                    name :result[item].name,
                    ellipse: {
                        semiMinorAxis: result[item].radius,
                        semiMajorAxis: result[item].radius,
                        height: 200,
                        material : Cesium.Color.RED.withAlpha(0.5),
                        outline: true, // height must be set for outline to display
                        outlineColor : Cesium.Color.BLUE,
                        outlineWidth : 3,
                        heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,
                        fill:false
                    },



                });


            }
        }});

}
    function removenavStationData(){
        viewer.entities.removeAll();
    }
    function removeServiceStationData(){
        viewer.entities.removeAll();
    }
    function pagerFilter(data){
        if (typeof data.length == 'number' && typeof data.splice == 'function'){	// is array
            data = {
                total: data.length,
                rows: data
            }
        }

        var dg = $(this);
        var opts = dg.datagrid('options');
        var pager = dg.datagrid('getPager');
        pager.pagination({
            onSelectPage:function(pageNum, pageSize){
                opts.pageNumber = pageNum;
                opts.pageSize = pageSize;
                pager.pagination('refresh',{
                    pageNumber:pageNum,
                    pageSize:pageSize
                });
                dg.datagrid('loadData',data);
            }
        });
        if (!data.originalRows){
            data.originalRows = (data.rows);
        }
        var start = (opts.pageNumber-1)*parseInt(opts.pageSize);
        var end = start + parseInt(opts.pageSize);
        data.rows = (data.originalRows.slice(start, end));
        return data;
    }

    function openTab(text,url,icon){

        if($("#tabs").tabs("exists",text)){
            $("#tabs").tabs("select",text);
            var selTab = $('#tabs').tabs('getSelected');
            var url = $(selTab.panel('options').content).attr('src');
            $('#tabs').tabs('update', {
                tab: selTab,
                options: {
                    content:createFrame(url)
                }
            })
        }else{

            var content="<iframe frameborder=0 scrolling='auto' id='"+url+"' name='"+url+"' style='width:100%;height:100%' src='"+url+"'></iframe>";
            $("#tabs").tabs("add",{
                title:text,
                iconCls:icon,
                content:content,
                closable:true,
            });
        }
    }

    function sleep(d){

        for(var t = Date.now();Date.now() - t <= d;);
    }




    function lianxudongtai(radius) {

        $.ajax({
            url:'/city/lianxudongtai',
            data:{radius:radius},
            type:'get',
            datatype:"json",
            async:"false",
            success:function(result){
                var str="";
                var tbody = document.getElementById("siteSelection").contentWindow.document.getElementById('airportsInCityBody');
                for (var item in result) {
                    if ((result[item].count!=0)&&item<15) {
                        str += "<tr>" +
                            "<td align='center'>" + result[item].city.cityName + "</td>" +
                            "<td align='center'>" + result[item].city.cityLon + "</td>" +
                            "<td align='center'>" + result[item].city.cityLat + "</td>" +
                            "<td align='center'>" + result[item].count + "</td>" +
                            "</tr>";
                        var entity = new Cesium.Entity({
                            id: 'city'+result[item].city.idcity,
                            name: result[item].city.cityName,
                            show: true,
                            position: Cesium.Cartesian3.fromDegrees(result[item].city.cityLon,result[item].city.cityLat),
                            point: new Cesium.PointGraphics({
                                show: false,
                                pixelSize: 5,
                                heightReference: Cesium.HeightReference.NONE,
                                color: new Cesium.Color(255, 255, 0, 1),
                                outlineColor: new Cesium.Color(0, 0, 0, 0),
                                outlineWidth: 1,
                                scaleByDistance: new Cesium.NearFarScalar(0, 1, 5e10, 1),
                                translucencyByDistance: new Cesium.NearFarScalar(0, 1, 5e10, 1),
                                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 4.8e10),

                            }),
                            ellipse: {
                                semiMinorAxis: radius,
                                semiMajorAxis: radius,
                                height: 200,
                                material: Cesium.Color.RED.withAlpha(0.5),
                                outline: true, // height must be set for outline to display
                                outlineColor: Cesium.Color.BLUE,
                                outlineWidth: 3,
                                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                                fill: false
                            },

                            label: {
                                text: result[item].city.cityName,
                                font: '10pt monospace',
                                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                                outlineWidth: 1,
                                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                                pixelOffset: new Cesium.Cartesian2(0, -9),
                            },
                            billboard: {
                                image: "../static/image/dingwei.png",
                                width: 16,
                                height: 16,
                            },
                        });
                        viewer.entities.add(entity);

                    }
                    tbody.innerHTML = str;
                }
            }});

    }


    function loadCityData(radius) {

        $.ajax({
            url:'/city/all',
            type:'get',
            datatype:"json",
            async:"false",
            success:function(result){
                for (var item in result) {

                    var entity = new Cesium.Entity({
                        id: result[item].idcity,
                        name: result[item].cityName,
                        show: true,
                        position: Cesium.Cartesian3.fromDegrees(result[item].cityLat, result[item].cityLon),
                        point: new Cesium.PointGraphics({
                            show: false,
                            pixelSize: 5,
                            heightReference: Cesium.HeightReference.NONE,
                            color: new Cesium.Color(255, 255, 0, 1),
                            outlineColor: new Cesium.Color(0, 0, 0, 0),
                            outlineWidth: 1,
                            scaleByDistance: new Cesium.NearFarScalar(0, 1, 5e10, 1),
                            translucencyByDistance: new Cesium.NearFarScalar(0, 1, 5e10, 1),
                            distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 4.8e10),

                        }),
                        ellipse: {
                            semiMinorAxis: radius,
                            semiMajorAxis: radius,
                            height: 200,
                            material : Cesium.Color.RED.withAlpha(0.5),
                            outline: true, // height must be set for outline to display
                            outlineColor : Cesium.Color.BLUE,
                            outlineWidth : 3,
                            heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,
                            fill:false
                        },

                        label: {
                            text: result[item].cityName,
                            font: '10pt monospace',
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            outlineWidth: 1,
                            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                            pixelOffset: new Cesium.Cartesian2(0, -9),
                        },
                        billboard: {
                            image: "../static/image/dingwei.png",
                            width: 16,
                            height: 16,
                        },
                    });
                    viewer.entities.add(entity);

                }


            }});
    }


    function createFrame(url){
        return '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
    }

</script>
</body>
</html>
